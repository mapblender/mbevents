function startup(){that=this,that.token="pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",L.mapbox.accessToken="pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg";var a=L.mapbox.map("map").setView([34.86394,-111.76486],14).addControl(L.mapbox.shareControl()).addControl(L.mapbox.geocoderControl("mapbox.places"));that.map=a;var b,c=new Date;b=c.toString("dddd, MMMM dd, yyyy h:mm tt"),that.gotoloc=[],that.loader=document.getElementById("loader");var d=L.mapbox.featureLayer("data/restaurant.json"),e=L.mapbox.featureLayer("sedonachamber.pmj9fija");window.location.href.indexOf("restaurants")>-1?(d.addTo(a),points=d):(e.addTo(a),points=e),addMouseClickListener(points),$("ul.nav.nav-pills li a").click(function(){a.removeLayer(d),a.removeLayer(e),"All"==this.innerText?(e.addTo(a),d.addTo(a)):this.innerText.search("Restaurants")>-1?(d.addTo(a),points=d,addMouseClickListener(points)):(e.addTo(a),points=e,addMouseClickListener(points)),$(this).parent().addClass("active").siblings().removeClass("active")}),(bowser.android||bowser.ios)&&(a.on("popupopen",function(b){var c=a.project(b.popup._latlng);c.y-=b.popup._container.clientHeight/2-100,a.panTo(a.unproject(c),{animate:!0})}),$(".nav-pills").css("margin-left","11%"),$(".nav-pills").css("font-size","15px"));var f=L.icon({iconUrl:"app/css/ripple.gif",iconAnchor:[10,10]}),g=L.control.locate({follow:!0,keepCurrentZoomLevel:!1,locateOptions:{maxZoom:16},metric:!1,showPopup:!0,markerClass:L.marker,markerStyle:{icon:f},onLocationError:function(a){vex.dialog.buttons.YES.text="OK";var b="";bowser.msie?b="<a target='_blank' style='color:#7A1800' href='http://windows.microsoft.com/en-us/internet-explorer/ie-security-privacy-settings#ie=ie-11'>How To </a>":bowser.chrome?b="<a target='_blank' style='color:#7A1800' href='https://support.google.com/chrome/answer/142065?hl=en'>How To </a>":bowser.firefox?b="<a target='_blank' style='color:#7A1800' href='https://support.mozilla.org/en-US/kb/improve-mozilla-location-services-turning-location'>How To </a>":bowser.android?b="<a target='_blank' style='color:#7A1800' href='https://support.scruff.com/hc/en-us/articles/202623634-How-do-I-enable-location-services-on-my-Android-'>How To </a>":bowser.ios&&(b="<a target='_blank' style='color:#7A1800' href='https://support.apple.com/en-us/HT203033'>How To </a>"),vex.dialog.alert({message:"Please Enable Your Location to find best directions from where you are.<br><br>"+b}),that.loader.className="hide"}}).addTo(a);c.getHours()>19||c.getHours()<7?L.control.layers({Streets:L.mapbox.tileLayer("mapbox.streets",{maxZoom:20}),Imagery:L.mapbox.tileLayer("mapbox.satellite",{maxZoom:20}),"Simple Streets":L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2opt8d00b9abnq6trki27e/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Outside:L.mapbox.tileLayer("mapbox.run-bike-hike"),Sedona:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin7oyyjz000waamcx7v412nr/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Red:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2kt8ku001sb4mawvdvwjxf/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Light:L.mapbox.tileLayer("mapbox.light"),Dark:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin961o3z00epcxnhaxgzwdb6/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}).addTo(a)},{}).addTo(a):L.control.layers({Streets:L.mapbox.tileLayer("mapbox.streets",{maxZoom:20}),Imagery:L.mapbox.tileLayer("mapbox.satellite",{maxZoom:20}),"Simple Streets":L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2opt8d00b9abnq6trki27e/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Outside:L.mapbox.tileLayer("mapbox.run-bike-hike"),Sedona:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin7oyyjz000waamcx7v412nr/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Red:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2kt8ku001sb4mawvdvwjxf/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}).addTo(a),Light:L.mapbox.tileLayer("mapbox.light"),Dark:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin961o3z00epcxnhaxgzwdb6/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20})},{}).addTo(a),that.loader.className="hide",a.on("locationfound",function(a){({type:"Feature",properties:{"marker-color":"#f00","marker-size":"small"},geometry:{type:"Point",coordinates:[a.longitude,a.latitude]}});if(0==that.gotoloc.length){var c=points.getGeoJSON(),d={};d.type="FeatureCollection",d.features=[];for(var e=0;e<c.features.length;e++)"Point"==c.features[e].geometry.type&&"bus"!=c.features[e].properties["marker-symbol"]&&"parking"!=c.features[e].properties["marker-symbol"]&&d.features.push(c.features[e]);var f=L.geoJson(d),g=L.GeometryUtil.closestLayer(that.map,f,a.latlng);bowser.android||bowser.ios||points.eachLayer(function(a){a.feature.properties.title===g.layer.feature.properties.title&&a.openPopup()}),a.accuracy>550?(that.map.setView(a.latlng,14),vex.dialog.buttons.YES.text="OK",vex.dialog.alert({message:"Your computer says you are over "+Number(a.accuracy/3.28084).toFixed(0)+" feet from here<br><br><br><b>Please enable wifi or use your phone to locate you."})):(that.map.setView(a.latlng,16),vex.dialog.buttons.YES.text="Get Directions",vex.dialog.alert({message:"You are within "+Number(a.accuracy/3.28084).toFixed(0)+" feet here!<br><br><i>"+g.layer.feature.properties.title+"</i> is closest to you.<br>",callback:function(b){if(1==b){var c=[g.layer.feature.geometry.coordinates[1],g.layer.feature.geometry.coordinates[0]];that.loader.className="",that.getdirections(a.latlng,c)}}}))}else"[object Array]"===Object.prototype.toString.call(that.gotoloc[0])?that.getdirections(a.latlng,that.gotoloc[0]):that.getdirections(a.latlng,that.gotoloc);that.map.stopLocate()});var h=L.Control.extend({options:{position:"bottomright"},onAdd:function(a){var b=L.DomUtil.create("div","img-control");return b}});a.addControl(new h),$(".img-control").click(function(){window.open("http://visitsedona.com/","_blank")}),vex.dialog.buttons.YES.text="Start Here",vex.dialog.buttons.NO.text="Browse Map",5==c.getDay()&&c.getDate()<7?b+='<br><br><a target="_blank" style="color:#7A1800" href="http://sedonagalleryassociation.com/?page_id=236">First Friday Art Walk. Click here for more information.</a></i>':4==c.getDay()&&c.getDate()<7?b+='<br><br><a target="_blank" style="color:#7A1800" href="http://sedonagalleryassociation.com/?page_id=236">First Friday Art Walk is tomorrow. Click here for more information.</a></i>':(c.getHours()>18||c.getHours()<8)&&(b+="<br><br><i>Galleries may be closed in the evening.</i>"),vex.dialog.confirm({message:"Welcome to the Walk Sedona Map!<br><br><a target='_blank' href='http://visitsedona.com/'><img src='assets/red_sedona.jpg' style='padding-bottom:20px !important;padding-right:32px !important;'></></a><a target='_blank' href='http://sedonagalleryassociation.com/'><img src='assets/sga-logo-web.jpg' style=''></></a><br><br>"+b,callback:function(a){1==a&&g.start()}})}function addMouseClickListener(a){a.on("click",function(a){a.layer.openPopup(),"Point"==a.layer.feature.geometry.type&&(that.gotoloc=[a.layer.feature.geometry.coordinates[1],a.layer.feature.geometry.coordinates[0]]),$("#direc").on("click",function(a){a.preventDefault(),that.loader.className="",that.map.stopLocate(),that.map.locate()}),that.layertitle=a.layer.feature.properties.title,$("#linksite").on("click",function(a){ga("send","event","linksite","click",that.layertitle)}),ga("send","event","marker","click",a.layer.feature.properties.title)})}function getdirections(a,b){that=this,that.directionlayer&&that.map.removeLayer(that.directionlayer),that.to&&that.map.removeLayer(that.to),that.from&&that.map.removeLayer(that.from),that.to=L.circle(b,26,{color:"#fff",fillColor:"#9E2C2E",fillOpacity:.7}).addTo(map),that.from=L.circle(a,26,{color:"#fff",fillColor:"#A1D490",fillOpacity:.7}).addTo(map).bindPopup("You are here.").bringToFront();var c="https://api.tiles.mapbox.com/v4/directions/mapbox.cycling/"+a.lng+","+a.lat+";"+b[1]+","+b[0]+".json?instructions=json&geometry=line&access_token="+that.token;$.get(c,function(a){if(a.routes.length>0){var b={};b.geometry=a.routes[0].geometry,b.type="Feature",b.properties={};var c="<i>Walking Time: "+Number(a.routes[0].duration/19).toFixed(0)+" minutes<br><br>Walking Distance: "+Number(621371e-9*a.routes[0].distance).toFixed(0)+" miles",d={color:"#61C5BE",weight:5,dashArray:"5,10",opacity:.9};that.directionlayer=L.geoJson(b,d).bindPopup(c).addTo(that.map);var e=that.directionlayer.getBounds();bowser.android||bowser.ios?(that.map.fitBounds(e,{padding:[73,73]}),that.directionlayer.eachLayer(function(a){a.openPopup()})):(that.map.fitBounds(e,{padding:[15,15]}),that.directionlayer.eachLayer(function(a){a.openPopup()}))}else vex.dialog.alert({message:"No Current Directions, please try again."});that.gotoloc=[],that.loader.className="hide"})}